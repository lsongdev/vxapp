# 测

作为一个基础库，测试必不可少。

项目采取的测试技术选型如下：

1. Mocha 测试框架
1. Chai 断言库
1. Sinon 模拟微信 API 接口
1. Istanbul 提供代码覆盖率统计
1. nyc 提供 Mocha 和 Istanbul 在 ES2015 下的运行方式
1. babel 辅助 ES2015 代码的运行和 instruction

测试文件均放置在 `test` 目录下，以 `.spec.js` 的后缀命名。

到目前位置仅对库的核心文件 `index.js` 编写了单元测试，CLI 工具由于设计文件操作和编译，比较复杂，暂时还没有编写测试。

目前 `index.js` 的单元测试的覆盖度：

| Statements  |  Branches | Functions | Lines |
|---|---|---|---|
|  90.34% | 80.33%  | 92.31% | 91.18% |

## 编写测试

由于库本身是运行在微信内的，因此在测试之前需要模拟一些在微信小程序环境下的全局函数和对象。这就是 `test` 目录下 `mini-program.js`、`wx.js` 的存在意义。`vxapp.js` 则是辅助库初始化的模块。

`mini-program.js` 模拟了小程序独有的全局函数，包括 `App()` 和 `Page()`。

`wx.js` 模拟了小程序环境的全局对象 `wx`，该对象下提供了非常多的接口。在编写单元测试的时候，如果遇到需要 `wx` 提供的函数，直接在 `wx` 中定义一个空函数，在测试环境中供 Sinon 作为「桩」来使用即可。

在为库添加了新功能之前，请先仔细设计好新功能的单元测试，做到「测试先行」。单元测试也应该尽量覆盖所有新添加的代码，尽力使全部测试的覆盖度达到 80% 以上。

在新功能添加完成之后，应进行一次回归测试，保证所有测试项都是通过状态。
